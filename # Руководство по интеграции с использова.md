# Руководство по интеграции с использованием Datareon

## Навигация и создание проекта

После запуска Datareon на вкладке "Инструменты разработчика" отображается список созданных проектов. При необходимости можно создать новый с помощью File -> New -> ESB Project
![Картинка][image3]

Двойным нажатием по созданному проекту открывается окно аутентификации. По умолчанию в проекте существует 2 пользователя - Администратор и Наблюдатель.

Пароль для наблюдателя не установлен. Для Администратора по умолчанию установлен пароль "123456" (без кавычек)

![Картинка][image1]

После авторизации в проекте его значек станет зеленым, в квадратных скобках рядом с название проекта указан пользователь, под которым произведена авторизация. Проект можно развернуть и увидеть все его содержимое.

![Картинка][image2]

Сменив перспективу с помощью соответствующей кнопки в правом верхнем углу приложения с Datareon:Разработка на Datareon:Управление можно увидеть список подлюченных адаптеров, список пользователей проекта.

![Картинка][image4]
## Создание адаптера
### Адаптер 1С
Подключим существующую базу 1С к Datareon. Для этого нажмем File -> New -> Адаптер 1С. Откроется окно создания адаптера.

На первом шаге необходимо указать проект, которому будет пренадлежать данный адаптер и его название.

![Картинка][image5]

На втором шаге необходимо заполнить всю информацию о подключаемой базе:
* Имя сервера, на котором она расположена
* Имя базы
* Имя пользователя
* Пароль

Для корректной работы Datareon в базе должен быть создан отдельный пользователь.
![Картинка][image6]

На последнем шаге необходимо просто нажать кнопку "Finish"
![Картинка][image8]

После создания адаптера 1С необходимо дождаться подключения Datareon к базе. Это занимает около минуты. После этого можно открыть информацию о подключенном адаптере. Если напротив всех точек подключения статус "Ok" - подключение прошло успешно.
![Картинка][image9]
### Файловый адаптер
Файловый адаптер позволяет читать файлы и отправлять сообщения с их содержимым на другие адаптера. А так же позволяет получать сообщения от любого адаптера и сохранять его содержимое в файл.
![Картинка][image10]
![Картинка][image11]
## Создание класса сообщений
Любое сообщение должно иметь свою структуру, которая строго задается при помощи класса сообщений. 

На первом шаге необходимо указать проект, которому будет пренадлежать данный класс и его название.

![Картинка][image12]

После создания нового класса необходимо заполнить его структуру. Это можно сделать несколькими способами:

* Создать поля вручную

* Импортировать из базы 1С, подключенной к Datareon
![Картинка][image13]
![Картинка][image14]
![Картинка][image15]
* Импортировать структуру из файла XML, указав к нему путь

В результате после заполнения можно увидеть структуру класса сообщения и тип его полей.

![Картинка][image16]

## Создание маршрута сообщений
Сообщения передаются по алгоритму Отправитель -> Datareon -> Получатели

С помощью маршрутов необходимо настроить пути сообщений, а именно - какое сообщение на какой адаптер будет отправлено при выполнении заданных условий.

Только что созданный пустой маршрут:
![Картинка][image17]

Создадим пустое условие передачи сообщения путем перетаскивания соответствующего блока на маршрут и добавим в него условие по классу сообщения. 
![Картинка][image18]
Добавим получателя сообщения путем перетаскивания блока "Получатели" на ветку условия "1". Таким образом, на адаптеры, указанные в списке получателей, будет отправляться сообщение при выполнении созданного ранее условия.
![Картинка][image19]

## Создание обработчика сообщений
После получения сообщения базой 1с будет выполнен код обработки сообщения, который располагается в обработчике данного класса сообщения. 

Есть два подхода к написанию кода обработчика со своими плюсами и минусами:

* Вызвать процедуру общего модуля, передав ей параметром XDTO объект.
* Расположить весь код в обработчике сообщений

Первый вариант позволяет проводить отладку средствами 1С, что недоступно во втором варианте, т.к. код обработчика сообщений в базе 1С вызывается с помощью метода Выполнить();

Второй вариант позволяет вносить изменения в код обработчика без необходимости обновления базы 1С.

Окно создания обработчика:
![Картинка][image20]

После создания обработчика необходимо указать для каких классов сообщений он будет вызываться и направление интеграции (Обработчик вызывается при отправке сообщения или при получении)
![Картинка][image21]
Также необходимо на вкладке "Приминение шаблона" указать, для каких адаптеров он будет выполняться.
![Картинка][image22]


[image1]: /Авторизация.PNG
[image2]: /ДеревоПроекта.PNG
[image3]: /ИнструментыРазработчика.PNG
[image4]: /Обозреватель.PNG

[image5]: /СозданиеАдаптера1с/1.PNG
[image6]: /СозданиеАдаптера1с/2.PNG

[image8]: /СозданиеАдаптера1с/3.PNG
[image9]: /СозданиеАдаптера1с/СтатусПодключения.PNG
[image10]: /СозданиеАдаптера1с/ФайловыйАдаптерВходящаяТочка.PNG
[image11]: /СозданиеАдаптера1с/ФайловыйАдаптерИсходящаяТочка.PNG

[image12]: /СозданиеКласса/1.PNG
[image13]: /СозданиеКласса/2.PNG
[image14]: /СозданиеКласса/3.PNG
[image15]: /СозданиеКласса/4.PNG
[image16]: /СозданиеКласса/5.PNG

[image17]: /СозданиеМаршрута/1.PNG
[image18]: /СозданиеМаршрута/2.PNG
[image19]: /СозданиеМаршрута/3.PNG

[image20]: /СозданиеОбработчика/1.PNG
[image21]: /СозданиеОбработчика/2.PNG
[image22]: /СозданиеОбработчика/3.PNG
